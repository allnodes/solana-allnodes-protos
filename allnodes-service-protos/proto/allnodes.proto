syntax = "proto3";

package allnodes.v5;

service AllnodesService {
  rpc GetShredVersion(GetShredVersionRequest) returns (GetShredVersionResponse) {}
  rpc GetBootstrapInfo(BootstrapInfoRequest) returns (BootstrapInfoResponse) {}
  rpc ProcessPohCoreConfig(ProcessPohCoreConfigRequest) returns (ProcessPohCoreConfigResponse) {}
  rpc ResolvePohCpuCore(ResolvePohCpuCoreRequest) returns (ResolvePohCpuCoreResponse) {}
  rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse) {}
}

message BootstrapInfoRequest {
  uint32 shred_version = 1;
  optional fixed64 mid = 2;
}

message BootstrapInfoResponse {
  SnapshotNode node = 1;
  uint64 flags = 2;
  bytes contact_info = 3;
  repeated Constant constants = 4;
}

message SnapshotNode {
  bytes rpc = 1;
  bytes pubkey = 2;
  bytes snapshot_hash = 3;
  uint64 latency = 4;
}

message Constant {
  string name = 1;
  string value = 2;
  bool is_persistent = 3;
}

message ProcessPohCoreConfigRequest {
  string cpu_info = 2;
}

message ProcessPohCoreConfigResponse {
  fixed64 cpuid = 1;
  repeated CoreConfig cores = 2;
}

message CoreConfig {
  uint32 processor_id = 1;
  uint32 core_id = 2;
  repeated uint32 vcore_ids = 3;
  optional uint64 score = 4;
}

message BenchmarkResults {
  repeated CoreConfig cores = 1;
}

message ResolvePohCpuCoreRequest {
  BenchmarkResults benchmark = 1;
  optional string isolated = 2;
}

message ResolvePohCpuCoreResponse {
  uint32 core_id = 1;
  optional string message = 2;
}

message HeartbeatRequest {}

message HeartbeatResponse {}

message GetShredVersionRequest {}

message GetShredVersionResponse {
  uint32 shred_version = 1;
}
